{% extends 'rango/base.html' %}
{% load static %}


{% block title_block %}
  {{ category.name }}
{% endblock %}

{% block body_block %}
  {% if category %}
    <h3>{{ category.name }}</h3>
    <div>
<strong id="like_count">{{ category.likes }}</strong> people like this category
      {% if user.is_authenticated %}
      <button id="likes" data-catid="{{category.id}}"
      class="btn btn-primary btn-sm" type="button">
      Like
      </button>
      <p id="liked" style="display: none">Test</p>
      {% endif %}
    </div>

    {% if pages %}
      <ul>
      {% for page in pages %}
        <li><a href="{% url 'goto' %}?page_id={{page.id}}">{{ page.title }}</a>
          {% if page.views > 1 %}
            &nbsp({{ page.views }} views)
          {% elif page.views == 1 %}
            &nbsp ({{ page.views }} view)
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <strong>No pages currently in category.</strong>
    {% endif %}
    <a href="{% url 'add_page' category.slug %}">Add a Page</a>
    {% if user.is_authenticated %}
      <div>
        <script async src="https://cse.google.com/cse.js?cx=b026cb20027162015"></script>
        <div class="gcse-searchbox"></div>
        <div class="gcse-searchresults" data-defaultToImageSearch="true"></div>
        <script>
          myWebResultsRenderedCallback = function(name, q, promos, results) {
            var adblock = document.getElementById("master-1");
            adblock.style.display="none";
          //  let btn = document.createElement("BUTTON");
          //  btn.innerHTML = "Add to Rango";
          //  adblock.insertAdjacentElement('afterend', btn);

            for (const div of promos.concat(results)) {
              const innerDiv = document.createElement('div');
          //    innerDiv.appendChild(document.createTextNode('Add: '));
              const a = div.querySelector('a.gs-title');
              //const btnDiv = document.createElement('span');
              const btn = document.createElement('BUTTON');
              btn.type = 'button';
              btn.class = "rango-add btn btn-info";
              btn.setAttribute("data-title", a.innerText);
              btn.setAttribute("data-url", a.href);
              btn.name = 'save';
              btn.innerHTML = "Add to Rango";
              btn.style.position = "relative";
              btn.style.left = "20px";
              //btnDiv.appendChild(btn);
              a.appendChild(btn);
              div.insertAdjacentElement('afterend', innerDiv);
            }
          };
          window.__gcse || (window.__gcse = {});
          window.__gcse.searchCallbacks = {
            web: {
              rendered: 'myWebResultsRenderedCallback',
            },
          };
        </script>
      </div>
    {% endif %}
  {% else %}
    The specified category does not exist!
  {% endif %}
{% endblock %}
